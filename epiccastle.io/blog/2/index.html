<!DOCTYPE HTML>
<html>
  <head>
      <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
      <meta content="width=device-width, initial-scale=1, user-scalable=yes" name="viewport">
      <meta content="#3E4450" name="theme-color">
      <meta content="Epic Castle" property="og:site_name">
      <meta content="https://epiccastle.io/" property="og:url">
      <meta content="website" property="og:type">
      <meta content="Epic Castle" property="og:title">
      <meta content="smart devops" property="og:description">
      <meta content="/images/icon-192.png" property="og:image">
      <meta content="image/png" property="og:image:type">
      <meta content="192" property="og:image:width">
      <meta content="192" property="og:image:height">
      <meta content="Epic Castle" name="twitter:card">
      <meta content="Epic Castle" name="twitter:title">
      <meta content="smart devops" name="twitter:description">
      <meta content="/images/icon-192.png" name="twitter:image">
      <meta content="yes" name="apple-mobile-web-app-capable">
      <meta content="Epic Castle" name="apple-mobile-web-app-title">
      <meta content="#3E4450" name="apple-mobile-web-app-status-bar-style">
      <meta content="true" name="HandheldFriendly">
      <meta content="telephone=no" name="format-detection">
      <!-- <link rel="manifest" href="/manifest.json"> -->
      <link href="/images/icon-512.png" rel="icon" sizes="512x512">
      <link href="/images/icon-192.png" rel="icon" sizes="192x192">
      <link href="/images/icon-180.png" rel="icon" sizes="180x180">
      <link href="/images/icon-152.png" rel="icon" sizes="152x152">
      <link href="/images/icon-120.png" rel="icon" sizes="120x120">
      <link href="/images/icon-96.png" rel="icon" sizes="96x96">
      <link href="/images/icon-76.png" rel="icon" sizes="76x76">
      <link href="/images/icon-72.png" rel="icon" sizes="72x72">
      <link href="/images/icon-60.png" rel="icon" sizes="60x60">
      <link href="/images/icon-48.png" rel="icon" sizes="48x48">
      <link href="/images/icon-36.png" rel="icon" sizes="36x36">
      <link href="/images/icon-192.png" rel="apple-touch-startup-image">
      <link href="/images/icon-192.png" rel="apple-touch-icon" sizes="192x192">
      <link href="/images/icon-128.png" rel="apple-touch-icon" sizes="128x128">
      <link href="/images/icon-96.png" rel="apple-touch-icon" sizes="96x96">
      <link href="/images/icon-48.png" rel="apple-touch-icon" sizes="48x48">
      <link href="/images/favicon.png" id="favicon" rel="shortcut icon" type="image/png">
      <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
      <link href="/assets/css/main.css" rel="stylesheet">
      <!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
      <!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
      <link href="https://epiccastle.io/blog/feed.xml" rel="alternate" title="Epiccastle.io Updates" type="application/rss+xml">
      
      
      <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/themes/prism-tomorrow.min.css" rel="stylesheet">
      
      
      
      <title>Epic Castle - Tiny Enlive Transformer Implements update-in</title>
      
  </head>
  <body>
    <div id="page-wrapper">

      <!-- Header -->
      <header id="header">
        <a href="/" style="border-bottom: none;">
          <img alt="" src="/images/logo.png">
        </a>
        <h1 id="logo-heading" style="font-family: 'Varela Round', sans-serif;">
          EPIC CASTLE
        </h1>
        <nav id="nav">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/blog">Blog</a></li>
            <li><a href="/contact.html">Contact</a></li>
          </ul>
        </nav>
      </header>

      <!-- Main -->
<div class="wrapper style1" id="main" style="padding-top: 0px;">
  <div class="container">
    <header>
      <h2 class="title-heading" style="margin-bottom:16px;">Tiny Enlive Transformer Implements update-in</h2>
      <div>
        <p>Useful little enlive snippet. Implements the behaviour of clojure's update-in function for use inside enlive/at</p>
      </div>
      <div style="display:flex;justify-content:left;padding-bottom:32px;">
        <div style="display:flex;">
          <img src="/images/people/crispin.jpg" style="width: 48px; height: 48px; border-radius: 50%;">
          <div style="text-align:left;margin-left:16px;">
            <div>Crispin Wellington</div>
            <div style="font-size: 14px;margin-top:-8px;">Jan 23, 2020 · 3 min read</div>
          </div>
        </div>
      </div>

    </header>
    <div class="row 150%">
      <div class="12u 12u$(medium)">

        <!-- Content -->
        <section id="content">
          <img alt="" class="fit image blog-splash" src="splash-20.png">
          <a href="https://unsplash.com/@milkandbourbons?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge" rel="noopener noreferrer" style="background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px;float:right;margin-top:-32px;" target="_blank" title="Download free do whatever you want high-resolution photos from Dean Brierley"><span style="display:inline-block;padding:2px 3px"><svg style="height:12px;width:auto;position:relative;vertical-align:middle;top:-2px;fill:white" viewbox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><title>unsplash-logo</title><path d="M10 9V0h12v9H10zm12 5h10v18H0V14h10v9h12v-9z"></path></svg></span><span style="display:inline-block;padding:2px 3px">Dean Brierley</span></a>
          <br>
          <h3>Modifying Markdown Document Links</h3><p>I have some markdown in a project on github. And it contains relative links. These relative link take you to other markdown files in the github repo. When you click the links on github the browser navigates to <code style="padding:0px;">doc/tutorial.md</code> and shows it in the github styling. All good.</p><p>Now I wan't to render these markdown documents onto my own server, with my own styling, for the project's home page. This site is comprised of static files generated with <a href="https://github.com/retrogradeorbit/bootleg">bootleg</a>. All the links in the documents look like: <code style="padding:0px;">doc/tutorial.md</code>. But I need them to look like this: <code style="padding:0px;">tutorial.html</code>. I need an a-tag-url-modifier. One takes in the <code style="padding:0px;">*.md</code> href string, and transforms it to the equivalent <code style="padding:0px;">*.html</code> string.</p><p>What would be even more useful is a transformer that can modify <i>any</i> part of the element, like clojure's <code style="padding:0px;">assoc-in</code> or an <code style="padding:0px;">update-in</code>.</p><p>It's very simple. Here is the implementation of an update-in transformer from my bootleg file:</p><pre class="language-" style="border-radius:8px;margin-bottom:32px;"><code class="clojure language-clojure" style="padding:0px;">(defn el-update-in [path func &amp; func-args]
  (fn [el]
    (apply update-in el path func func-args)))
</code></pre><p>I could append a html file extension to all the <code style="padding:0px;">&lt;a&gt;</code> tags with:</p><pre class="language-" style="border-radius:8px;margin-bottom:32px;"><code class="clojure language-clojure" style="padding:0px;">[:section
 [:div.container
  (-&gt; (markdown &quot;body.md&quot;)
      (enlive/at [:a] (el-update-in [:attrs :href] str &quot;.html&quot;)))]]
</code></pre><p>The <code style="padding:0px;">el-update-in</code> function returns the transformer. The transformer operates on a hickory element. These elements have the keys <code style="padding:0px;">:type</code>, <code style="padding:0px;">:tag</code>, <code style="padding:0px;">:attrs</code> and <code style="padding:0px;">:content</code>. Here I run the <code style="padding:0px;">str</code> function on the contents of the path <code style="padding:0px;">[:attrs :href]</code>. You could access any attr this way, like <code style="padding:0px;">[:attrs :class]</code> or even run on sub elements, with something like <code style="padding:0px;">[:content 0]</code>!</p><p>Here is my solution to my path transformation problem.</p><pre class="language-" style="border-radius:8px;margin-bottom:32px;"><code class="clojure language-clojure" style="padding:0px;">[:section
 [:div.container
  (-&gt; (markdown &quot;body.md&quot;)
      (enlive/at
       [:a] (el-update-in [:attrs :href] #(-&gt; %
                                              (string/split #&quot;/&quot; -1)
                                              last
                                              (string/split #&quot;\.&quot; -1)
                                              butlast
                                              (-&gt;&gt; (string/join &quot;.&quot;))
                                              (str &quot;.html&quot;)))))]]
</code></pre><p>I split the string up by <code style="padding:0px;">/</code> and take the last segment. Then hackishly remove the file extension. Then add the html extension. This turns <code style="padding:0px;">doc/tutorial.md</code> to <code style="padding:0px;">tutorial.html</code>.</p>
        </section>
      </div>

      <section>
        <div class="12u 12u$(medium)">
          <span class="right"><img src="/images/people/crispin.jpg" style="width: 48px; height: 48px; border-radius: 50%;"></span>
          <h4>About Crispin Wellington</h4>
          <p>Crispin Wellington is a Software Developer and System Operations expert with over 25 years of professional experience. As well as being the founder of <a href="https://epiccastle.io">Epic Castle</a> he is the founder and developer of <a href="https://gammon.io">gammon.io</a>. He is based in Perth, Australia and is a husband and father. As Epic Castle's principal consultant he is available to assist you in solving your software, operations and service problems.
        </p></div>

        <div class="8u 12u$(medium)">
          <h4>Don't miss the next update</h4>
          <p>Make sure you don't miss the next article. Get the latest content first.</p>
          <form action="https://lists.epiccastle.io/mailman/subscribe/epiccastle-blog" method="post">
            <div class="row uniform 50%">
              <div class="6u$ 12u$(xsmall)">
                <input id="email" name="email" placeholder="Email" type="email" value="">
              </div>
              <div class="6u$ 12u$(xsmall)">
                <input class="button special" name="email-bitton" style="padding-left: 16px; padding-right: 16px;" type="submit" value="Join Us">
              </div>
            </div>
          </form>
        </div>
    </section></div>
  </div>
</div>


      <!-- Footer -->
      <footer id="footer">
        <ul class="copyright">
          <li>© Epic Castle</li>
          <li>All rights reserved</li>
          <li><a href="https://github.com/epiccastle/epiccastle.io">Built</a> with <a href="https://github.com/retrogradeorbit/bootleg">bootleg</a></li>
        </ul>
      </footer>
    </div>

    <!-- Scripts -->
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/jquery-migrate-1.4.1.min.js"></script>
    <script src="/assets/js/jquery.scrolly.min.js"></script>
    <script src="/assets/js/jquery.dropotron.min.js"></script>
    <script src="/assets/js/skel.min.js"></script>
    <script src="/assets/js/util.js"></script>
    <script src="/assets/js/responsiveCarousel.js"></script>
    <!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
    <script src="/assets/js/main.js"></script>
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-core.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/plugins/autoloader/prism-autoloader.min.js"></script>
    
    
  </body>
</html>
